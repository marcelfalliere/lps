<ion-view id="page-home">
  <ion-header-bar>
    <h1 class="title">20 TRUCS</h1>
    <a class="button button-icon icon ion-camera" ui-sref="compose"></a>
  </ion-header-bar>
  <ion-content scroll="false" magicthumb>

    <div class="threads">
    	
    	<material-popup-backdrop></material-popup-backdrop>

			<div class="thread index-{{$index}}" 
					 material-popup entity="thread"
					 ng-repeat="thread in threads track by $index" >
				<div class="details-when-popup header">
					<span class="index"><em>#</em>{{$index+1}}</span>
					<span class="id">{{thread.incrementalId}}<sup>ème</sup></span>
				</div>

				<div class="thread-image">
					<img ng-if="thread.image!=undefined"
							 img-cache ic-src="{{thread.image}}" />
					<img ng-if="thread.image==undefined"
							 src="img/fmf.jpeg" />
				</div>
				<div class="details-when-popup">
					<span class="date">créé le {{ thread.createdAt | date :'dd/MM/yyyy @ h:mma' }}</span>
				</div>
				<div class="details-when-popup">
					<span class="seen">vu {{thread.seen}} fois</span>
				</div>

				<div class="details-when-popup loading" ng-if="thread.loadingAnswers == true">
					<ion-spinner></ion-spinner>
				</div>

				<div class="details-when-popup empty-answers" ng-if="thread.loadingAnswers == false && (thread.answers == undefined || thread.answers.length == 0)">
					<span class="text">Personne n'a répondu _\o/</span>
				</div>

				<div class="details-when-popup answer" ng-if="thread.loadingAnswers == false && !(thread.answers == undefined || thread.answers.length == 0)" ng-repeat="answer in thread.answers">
					<span class="text">{{answer.text}}</span>
				</div>
				
				<div class="details-when-popup form">
					<div class="button button-block button-positive" ng-if="thread.seeMode!='form'" ng-click="doAnswer(thread)">Répondre</div>
					<form ng-submit="doPostAnswer(thread)" ng-if="thread.seeMode=='form'">
						<textarea ng-model="thread.newAnswer" tagged-autogrow></textarea>
						<button ng-disabled="thread.postingAnswer" class="button button-block button-positive" type="submit">Envoyer</button>
					</form>
				</div>
				

			</div>
		</div>


  </ion-content>
</ion-view>
